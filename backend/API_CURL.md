# JITU Backend API – cURL / Postman

Base URL: **http://localhost:8080**

- **Public API** (`/api/categories`, `/api/links`) – read-only for the app.
- **Admin API** (`/api/admin/categories`, `/api/admin/links`) – full CRUD, **protected by API key**.

**Admin auth:** Set `ADMIN_API_KEY` in backend `.env` (min 8 characters). For every admin request send:
- `X-Admin-Key: <your-key>`  
  or  
- `Authorization: Bearer <your-key>`

**Visitor access (dashboard):** Visitors must verify with a private key (shared by admin). First time: `POST /api/visitor/verify` with `privateKey` and `deviceId`; device is stored if under `noOfDevice` limit. Returning: `GET /api/visitor/me` with headers `X-Visitor-Key` and `X-Device-ID` to confirm access.

---

## Health

### GET Health check

```bash
curl -X GET http://localhost:8080/api/health
```

---

## Public API (read-only)

### Categories

#### GET All categories (with link counts)

```bash
curl -X GET http://localhost:8080/api/categories
```

#### GET Single category (with its links)

Replace `{categoryId}` with a real `_id` from the categories list.

```bash
curl -X GET http://localhost:8080/api/categories/{categoryId}
```

### Links

#### GET Links by category

Replace `{categoryId}` with a category `_id`. Response includes `likes`, `views`, `replies` per link.

```bash
curl -X GET http://localhost:8080/api/links/category/{categoryId}
```

#### POST Increment view (when link is viewed)

Replace `{linkId}` with a link `_id`. Returns the updated link.

```bash
curl -X POST http://localhost:8080/api/links/{linkId}/view
```

#### POST Increment like

Replace `{linkId}` with a link `_id`. Returns the updated link.

```bash
curl -X POST http://localhost:8080/api/links/{linkId}/like
```

#### POST Increment reply (when user posts a comment/reply in discussion)

Replace `{linkId}` with a link `_id`. Returns the updated link.

```bash
curl -X POST http://localhost:8080/api/links/{linkId}/reply
```

### Visitor verify & session (dashboard access)

#### POST Verify (first-time visitor)

Body: `privateKey` (shared by admin), `deviceId` (generated by client). If key is invalid → 404. If device limit reached → 403. Otherwise device is added and visitor is returned.

```bash
curl -X POST http://localhost:8080/api/visitor/verify \
  -H "Content-Type: application/json" \
  -d '{"privateKey":"XXXX-XXXX-XXXX-XXXX-XXXX-XXXX","deviceId":"client-device-uuid"}'
```

#### GET Me (returning visitor)

Headers: `X-Visitor-Key` (privateKey), `X-Device-ID`. If device is in visitor’s list → 200 + visitor. Otherwise → 401.

```bash
curl -X GET http://localhost:8080/api/visitor/me \
  -H "X-Visitor-Key: XXXX-XXXX-XXXX-XXXX-XXXX-XXXX" \
  -H "X-Device-ID: client-device-uuid"
```

### Preview

#### GET Link preview (Open Graph meta)

```bash
curl -X GET "http://localhost:8080/api/preview?url=https://example.com"
```

---

## Admin API (full CRUD)

All admin requests require the API key. The examples below use the default dev key `dev-admin-key-123` (set in `.env` as `ADMIN_API_KEY`); change it in production.

### Admin – Categories

#### GET All categories

```bash
curl -X GET http://localhost:8080/api/admin/categories \
  -H "X-Admin-Key: dev-admin-key-123"
```

#### GET Category by ID

```bash
curl -X GET http://localhost:8080/api/admin/categories/{categoryId} \
  -H "X-Admin-Key: dev-admin-key-123"
```

#### POST Create category

```bash
curl -X POST http://localhost:8080/api/admin/categories \
  -H "X-Admin-Key: dev-admin-key-123" \
  -H "Content-Type: application/json" \
  -d '{"name":"My Category","order":0}'
```

#### PUT Update category

Replace `{categoryId}` with category `_id`.

```bash
curl -X PUT http://localhost:8080/api/admin/categories/{categoryId} \
  -H "X-Admin-Key: dev-admin-key-123" \
  -H "Content-Type: application/json" \
  -d '{"name":"Updated Name","order":1}'
```

#### DELETE Category

```bash
curl -X DELETE http://localhost:8080/api/admin/categories/{categoryId} \
  -H "X-Admin-Key: dev-admin-key-123"
```

---

### Admin – Links

#### GET Links by category

```bash
curl -X GET http://localhost:8080/api/admin/links/category/{categoryId} \
  -H "X-Admin-Key: dev-admin-key-123"
```

#### GET Link by ID

Replace `{linkId}` with link `_id`.

```bash
curl -X GET http://localhost:8080/api/admin/links/{linkId} \
  -H "X-Admin-Key: dev-admin-key-123"
```

#### POST Create link

Replace `{categoryId}` with a valid category `_id`.

```bash
curl -X POST http://localhost:8080/api/admin/links \
  -H "X-Admin-Key: dev-admin-key-123" \
  -H "Content-Type: application/json" \
  -d '{"url":"https://example.com","label":"Example","category":"{categoryId}"}'
```

#### PUT Update link

Replace `{linkId}` with link `_id`.

```bash
curl -X PUT http://localhost:8080/api/admin/links/{linkId} \
  -H "X-Admin-Key: dev-admin-key-123" \
  -H "Content-Type: application/json" \
  -d '{"url":"https://updated.com","label":"Updated Label"}'
```

#### DELETE Link

```bash
curl -X DELETE http://localhost:8080/api/admin/links/{linkId} \
  -H "X-Admin-Key: dev-admin-key-123"
```

### Admin – Visitors

Visitor: `privateKey`, `name`, `role` (required); `deviceID` (array, default `[]`); `noOfDevice` (number, default `0`).

#### GET All visitors

```bash
curl -X GET http://localhost:8080/api/admin/visitors \
  -H "X-Admin-Key: dev-admin-key-123"
```

#### GET Visitor by ID

```bash
curl -X GET http://localhost:8080/api/admin/visitors/{visitorId} \
  -H "X-Admin-Key: dev-admin-key-123"
```

#### POST Create visitor

```bash
curl -X POST http://localhost:8080/api/admin/visitors \
  -H "X-Admin-Key: dev-admin-key-123" \
  -H "Content-Type: application/json" \
  -d '{"privateKey":"my-secret-key","name":"John","role":"viewer","deviceID":[],"noOfDevice":0}'
```

#### PUT Update visitor

```bash
curl -X PUT http://localhost:8080/api/admin/visitors/{visitorId} \
  -H "X-Admin-Key: dev-admin-key-123" \
  -H "Content-Type: application/json" \
  -d '{"privateKey":"...","name":"...","role":"...","deviceID":[],"noOfDevice":0}'
```

#### DELETE Visitor

```bash
curl -X DELETE http://localhost:8080/api/admin/visitors/{visitorId} \
  -H "X-Admin-Key: dev-admin-key-123"
```

---

## Postman setup

1. Create an environment with **baseUrl**: `http://localhost:8080` and **adminKey**: `dev-admin-key-123` (or your `ADMIN_API_KEY` from `.env`).
2. For **Admin** requests, add header: `X-Admin-Key` = `{{adminKey}}`.
3. Use the paths below. For POST/PUT: Body → raw → JSON.

**Public**

| Method | Path |
|--------|------|
| GET | `{{baseUrl}}/api/health` |
| GET | `{{baseUrl}}/api/categories` |
| GET | `{{baseUrl}}/api/categories/{{categoryId}}` |
| GET | `{{baseUrl}}/api/links/category/{{categoryId}}` |
| GET | `{{baseUrl}}/api/preview?url=https://example.com` |

**Admin – Categories**

| Method | Path | Body |
|--------|------|------|
| GET | `{{baseUrl}}/api/admin/categories` | — |
| GET | `{{baseUrl}}/api/admin/categories/{{categoryId}}` | — |
| POST | `{{baseUrl}}/api/admin/categories` | `{"name":"My Category","order":0}` |
| PUT | `{{baseUrl}}/api/admin/categories/{{categoryId}}` | `{"name":"...","order":0}` |
| DELETE | `{{baseUrl}}/api/admin/categories/{{categoryId}}` | — |

**Admin – Links**

| Method | Path | Body |
|--------|------|------|
| GET | `{{baseUrl}}/api/admin/links/category/{{categoryId}}` | — |
| GET | `{{baseUrl}}/api/admin/links/{{linkId}}` | — |
| POST | `{{baseUrl}}/api/admin/links` | `{"url":"...","label":"...","category":"<id>"}` |
| PUT | `{{baseUrl}}/api/admin/links/{{linkId}}` | `{"url":"...","label":"..."}` |
| DELETE | `{{baseUrl}}/api/admin/links/{{linkId}}` | — |

**Admin – Visitors**

| Method | Path | Body |
|--------|------|------|
| GET | `{{baseUrl}}/api/admin/visitors` | — |
| GET | `{{baseUrl}}/api/admin/visitors/{{visitorId}}` | — |
| POST | `{{baseUrl}}/api/admin/visitors` | `{"privateKey":"...","name":"...","role":"...","deviceID":[],"noOfDevice":0}` |
| PUT | `{{baseUrl}}/api/admin/visitors/{{visitorId}}` | `{"privateKey":"...","name":"...","role":"...","deviceID":[],"noOfDevice":0}` |
| DELETE | `{{baseUrl}}/api/admin/visitors/{{visitorId}}` | — |

Run the backend with `npm run dev` in the **backend** folder before testing.
